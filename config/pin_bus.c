#include <pin_bus.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

/** (digital) pins used for the data bus (D0-D7). */
const uint8_t DATA_PINS[NUM_DATA_PINS] =
{
       22, 24, 26, 28, 30, 32, 34, 36
};

/** (digital) Pins used for the address bus (A0-A14). */
const uint8_t ADDR_PINS[NUM_ADDR_PINS] =
{
       23, 25, 27, 29, 31, 33, 35, 37,
       39, 41, 43, 45, 47, 49, 51
};

const uint8_t WE_PIN    = 2; /** SRAM control pin: Write Enable (active low). */
const uint8_t OE_PIN    = 3; /** SRAM control pin: Output Enable (active low). */
const uint8_t CS_PIN    = 4; /** SRAM control pin: Chip Select (active low). */

const uint8_t RESET_PIN = 5; /** 6502 pin: Reset (active low). */
const uint8_t BE_PIN    = 6; /** 6502 pin: Bus Enable (active low). */
const uint8_t CLK_PIN   = 11;/** 6502 pin: Clock signal */

/* control pins TBD */
const uint8_t SEND_PIN  = 7;

/* Program to be injected
 *
 * TODO: maybe add a script that sends more programs via serial communication?
 * NOTE: changed to not const because now it can be edited via UART
 * NOTE: now this is just a placeholder
 */
uint8_t program[][16] = 
{
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
};

/*     READ/WRITE/LOOP TEST PROGRAM
 *
 *     0200:  0xA9 0xFF            ; LDA FF
 *     0202:  0x8D 0x27 0x02       ; STA 0x0227
 *     0205:  0xEA                 ; NOP
 *     0206:  0x4C 0x00 0x02       ; JMP 0200
 */
uint8_t program_loop[][16] = 
{
       { 0xa9, 0xFF, 0x8d, 0x27, 0x02, 0xea, 0x4c, 0x00, 0x02, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
};

/* MEMORY INCREMENT/JSR/STACK TEST PROGRAM
 * --- main 
 * 200:       0xA9 0x00            ; LDA #00
 * 202:       0x8D 0x1C 0x02       ; STA $021C
 * 205:       0x20 0x10 0x02       ; JSR $0210
 * 208:       0x4C 0x05 0x02       ; JMP $0205
 * 20B:       0xEA
 * --- subroutine
 * 210:       0xEE 0x1C 0x02       ; INC $021C
 * 213:       0x60                 ; RTS
 * 214:       0xEA                 ; NOP
 */
uint8_t program_jsr[][16] =
{
       { 0xA9, 0x00, 0x8D, 0x1C, 0x02, 0x20, 0x10, 0x02, 0x4C, 0x05, 0x02, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA },
       { 0xEE, 0x1C, 0x02, 0x60, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA, 0xEA },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
       { 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea, 0xea },
};

inline size_t get_program_size ()
{
       return sizeof (program);
}

inline size_t get_program_rows ()
{
       return get_program_size () / 16;
}
